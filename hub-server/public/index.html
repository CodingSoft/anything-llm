<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Community Hub - CodingSoft</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
--bg-primary: #0f0f0f;
--bg-secondary: #1a1a1a;
--bg-tertiary: #2a2a2a;
--bg-card: #1a1a1a;
--text-primary: #ffffff;
--text-secondary: rgba(255, 255, 255, 0.7);
--text-muted: rgba(255, 255, 255, 0.5);
--border-color: #333333;
--accent-primary: #46c8ff;
--accent-secondary: #7cd4fd;
--accent-gradient: linear-gradient(135deg, #46c8ff, #7cd4fd);
--card-hover: #252525;
--success: #22c55e;
--warning: #f59e0b;
--error: #ef4444;
--shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
--shadow-md: 0 4px 6px rgba(0,0,0,0.4);
--shadow-lg: 0 10px 25px rgba(0,0,0,0.5);
--radius-sm: 6px;
--radius-md: 8px;
--radius-lg: 12px;
--radius-xl: 16px;
--prompt-color: #a855f7;
--command-color: #f59e0b;
--skill-color: #10b981;
--flow-color: #3b82f6;
}

[data-theme="light"] {
--bg-primary: #ffffff;
--bg-secondary: #f8f9fa;
--bg-tertiary: #e9ecef;
--bg-card: #ffffff;
--text-primary: #1a1a1a;
--text-secondary: #495057;
--text-muted: #6c757d;
--border-color: #dee2e6;
--accent-primary: #0284c7;
--accent-secondary: #0369a1;
--accent-gradient: linear-gradient(135deg, #0284c7, #0369a1);
--card-hover: #f1f3f5;
--shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
--shadow-md: 0 4px 6px rgba(0,0,0,0.07);
--shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
}

body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
background: var(--bg-primary);
color: var(--text-primary);
min-height: 100vh;
line-height: 1.6;
}

/* Navbar estilo AnythingLLM */
.navbar {
background: var(--bg-secondary);
border-bottom: 1px solid var(--border-color);
padding: 0 1.5rem;
height: 64px;
display: flex;
align-items: center;
position: sticky;
top: 0;
z-index: 100;
}

.navbar-content {
max-width: 1400px;
width: 100%;
margin: 0 auto;
display: flex;
align-items: center;
justify-content: space-between;
gap: 1.5rem;
}

.logo {
display: flex;
align-items: center;
gap: 0.75rem;
text-decoration: none;
color: var(--text-primary);
font-weight: 600;
font-size: 1.125rem;
}

.logo-icon {
width: 36px;
height: 36px;
background: var(--accent-gradient);
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
font-size: 1.25rem;
box-shadow: var(--shadow-md);
}

.nav-center {
flex: 1;
max-width: 480px;
}

.search-box {
position: relative;
width: 100%;
}

.search-input {
width: 100%;
padding: 0.625rem 1rem 0.625rem 2.75rem;
background: var(--bg-primary);
border: 1px solid var(--border-color);
border-radius: var(--radius-lg);
color: var(--text-primary);
font-size: 0.9375rem;
outline: none;
transition: all 0.2s ease;
}

.search-input:focus {
border-color: var(--accent-primary);
box-shadow: 0 0 0 3px rgba(70, 200, 255, 0.15);
}

.search-icon {
position: absolute;
left: 1rem;
top: 50%;
transform: translateY(-50%);
color: var(--text-muted);
width: 18px;
height: 18px;
}

.nav-links {
display: flex;
align-items: center;
gap: 0.5rem;
}

.nav-link {
display: flex;
align-items: center;
gap: 0.5rem;
padding: 0.625rem 1rem;
color: var(--text-secondary);
text-decoration: none;
font-size: 0.9375rem;
font-weight: 500;
border-radius: var(--radius-md);
transition: all 0.2s ease;
}

.nav-link:hover {
color: var(--text-primary);
background: var(--bg-tertiary);
}

.nav-link.active {
color: var(--accent-primary);
background: rgba(70, 200, 255, 0.1);
}

.theme-toggle {
width: 40px;
height: 40px;
border-radius: var(--radius-md);
border: 1px solid var(--border-color);
background: var(--bg-primary);
color: var(--text-primary);
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
font-size: 1.125rem;
transition: all 0.2s ease;
margin-left: 0.5rem;
}

.theme-toggle:hover {
background: var(--card-hover);
border-color: var(--accent-primary);
}

/* Main content */
.main {
max-width: 1400px;
margin: 0 auto;
padding: 2rem 1.5rem;
}

/* Hero section */
.hero {
text-align: center;
margin-bottom: 3rem;
padding: 2rem 0;
}

.hero-title {
font-size: 2.5rem;
font-weight: 700;
margin-bottom: 0.75rem;
background: var(--accent-gradient);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.hero-subtitle {
font-size: 1.125rem;
color: var(--text-secondary);
max-width: 600px;
margin: 0 auto;
}

/* Category filters */
.category-filters {
display: flex;
gap: 0.75rem;
margin-bottom: 2.5rem;
overflow-x: auto;
padding-bottom: 0.5rem;
scrollbar-width: none;
}

.category-filters::-webkit-scrollbar {
display: none;
}

.filter-btn {
padding: 0.625rem 1.25rem;
background: var(--bg-secondary);
border: 1px solid var(--border-color);
border-radius: var(--radius-lg);
color: var(--text-secondary);
font-size: 0.9375rem;
font-weight: 500;
cursor: pointer;
transition: all 0.2s ease;
display: flex;
align-items: center;
gap: 0.5rem;
white-space: nowrap;
}

.filter-btn:hover {
background: var(--bg-tertiary);
color: var(--text-primary);
border-color: var(--accent-primary);
}

.filter-btn.active {
background: var(--accent-primary);
color: #000;
border-color: var(--accent-primary);
}

/* Section title */
.section-header {
display: flex;
align-items: center;
justify-content: space-between;
margin-bottom: 1.5rem;
}

.section-title {
font-size: 1.25rem;
font-weight: 600;
display: flex;
align-items: center;
gap: 0.75rem;
}

.section-icon {
width: 32px;
height: 32px;
border-radius: var(--radius-md);
display: flex;
align-items: center;
justify-content: center;
font-size: 1rem;
}

.section-icon.prompts { background: rgba(168, 85, 247, 0.15); color: var(--prompt-color); }
.section-icon.commands { background: rgba(245, 158, 11, 0.15); color: var(--command-color); }
.section-icon.skills { background: rgba(16, 185, 129, 0.15); color: var(--skill-color); }
.section-icon.flows { background: rgba(59, 130, 246, 0.15); color: var(--flow-color); }

.item-count {
font-size: 0.875rem;
color: var(--text-muted);
background: var(--bg-secondary);
padding: 0.375rem 0.875rem;
border-radius: var(--radius-lg);
font-weight: 500;
}

/* Grid */
.items-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
gap: 1.25rem;
margin-bottom: 3rem;
}

/* Cards */
.item-card {
background: var(--bg-card);
border: 1px solid var(--border-color);
border-radius: var(--radius-xl);
padding: 1.25rem;
cursor: pointer;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
position: relative;
overflow: hidden;
}

.item-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 3px;
background: var(--accent-gradient);
opacity: 0;
transition: opacity 0.3s ease;
}

.item-card:hover {
background: var(--card-hover);
border-color: var(--accent-primary);
transform: translateY(-3px);
box-shadow: var(--shadow-lg);
}

.item-card:hover::before {
opacity: 1;
}

.item-card.type-prompt::before { background: linear-gradient(90deg, var(--prompt-color), #c084fc); }
.item-card.type-command::before { background: linear-gradient(90deg, var(--command-color), #fbbf24); }
.item-card.type-skill::before { background: linear-gradient(90deg, var(--skill-color), #34d399); }
.item-card.type-flow::before { background: linear-gradient(90deg, var(--flow-color), #60a5fa); }

.card-header {
display: flex;
align-items: flex-start;
gap: 0.875rem;
margin-bottom: 0.875rem;
}

.card-icon {
width: 40px;
height: 40px;
border-radius: var(--radius-md);
display: flex;
align-items: center;
justify-content: center;
font-size: 1.25rem;
flex-shrink: 0;
}

.card-icon.prompts { background: rgba(168, 85, 247, 0.1); color: var(--prompt-color); }
.card-icon.commands { background: rgba(245, 158, 11, 0.1); color: var(--command-color); }
.card-icon.skills { background: rgba(16, 185, 129, 0.1); color: var(--skill-color); }
.card-icon.flows { background: rgba(59, 130, 246, 0.1); color: var(--flow-color); }

.card-title-group {
flex: 1;
min-width: 0;
}

.card-title {
font-size: 1rem;
font-weight: 600;
color: var(--text-primary);
margin-bottom: 0.25rem;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}

.card-meta {
display: flex;
align-items: center;
gap: 0.5rem;
font-size: 0.75rem;
color: var(--text-muted);
}

.visibility-badge {
padding: 0.125rem 0.5rem;
border-radius: 4px;
font-size: 0.625rem;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.025em;
}

.visibility-badge.public {
background: rgba(34, 197, 94, 0.1);
color: var(--success);
}

.visibility-badge.private {
background: rgba(239, 68, 68, 0.1);
color: var(--error);
}

.card-description {
font-size: 0.9375rem;
color: var(--text-secondary);
line-height: 1.5;
margin-bottom: 1rem;
display: -webkit-box;
-webkit-line-clamp: 2;
-webkit-box-orient: vertical;
overflow: hidden;
}

.card-footer {
display: flex;
align-items: center;
justify-content: space-between;
margin-top: auto;
}

.card-tags {
display: flex;
gap: 0.375rem;
flex-wrap: wrap;
}

.card-tag {
font-size: 0.6875rem;
color: var(--text-muted);
background: var(--bg-secondary);
padding: 0.25rem 0.5rem;
border-radius: 4px;
border: 1px solid var(--border-color);
}

.card-action {
color: var(--accent-primary);
font-size: 0.9375rem;
font-weight: 600;
display: flex;
align-items: center;
gap: 0.25rem;
}

/* Empty state */
.empty-state {
text-align: center;
padding: 5rem 2rem;
color: var(--text-muted);
}

.empty-state-icon {
font-size: 4rem;
margin-bottom: 1.25rem;
opacity: 0.6;
}

.empty-state-title {
font-size: 1.375rem;
font-weight: 600;
color: var(--text-primary);
margin-bottom: 0.5rem;
}

.empty-state-text {
font-size: 1rem;
color: var(--text-secondary);
max-width: 400px;
margin: 0 auto;
}

/* Skeleton loading */
.skeleton-container {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
gap: 1.25rem;
}

.skeleton-card {
background: var(--bg-card);
border: 1px solid var(--border-color);
border-radius: var(--radius-xl);
padding: 1.25rem;
height: 200px;
}

.skeleton {
background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-secondary) 50%, var(--bg-tertiary) 75%);
background-size: 200% 100%;
animation: skeleton-loading 1.5s infinite;
border-radius: var(--radius-md);
}

@keyframes skeleton-loading {
0% { background-position: 200% 0; }
100% { background-position: -200% 0; }
}

.skeleton-circle {
width: 40px;
height: 40px;
border-radius: 50%;
}

.skeleton-line {
height: 16px;
margin-bottom: 0.75rem;
}

.skeleton-line.short {
width: 60%;
}

.skeleton-line.medium {
width: 80%;
}

/* Modal */
.modal-overlay {
display: none;
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0, 0, 0, 0.8);
backdrop-filter: blur(8px);
z-index: 1000;
align-items: center;
justify-content: center;
padding: 1.5rem;
opacity: 0;
transition: opacity 0.3s ease;
}

.modal-overlay.active {
display: flex;
opacity: 1;
}

.modal {
background: var(--bg-secondary);
border: 1px solid var(--border-color);
border-radius: var(--radius-xl);
max-width: 600px;
width: 100%;
max-height: 85vh;
overflow-y: auto;
box-shadow: var(--shadow-lg);
transform: scale(0.95) translateY(20px);
opacity: 0;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-overlay.active .modal {
transform: scale(1) translateY(0);
opacity: 1;
}

.modal-header {
padding: 1.5rem;
border-bottom: 1px solid var(--border-color);
display: flex;
align-items: center;
justify-content: space-between;
gap: 1rem;
}

.modal-title-group {
flex: 1;
}

.modal-title {
font-size: 1.25rem;
font-weight: 600;
margin-bottom: 0.25rem;
}

.modal-subtitle {
font-size: 0.9375rem;
color: var(--text-secondary);
}

.modal-close {
width: 36px;
height: 36px;
border-radius: var(--radius-md);
border: 1px solid var(--border-color);
background: var(--bg-primary);
color: var(--text-secondary);
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
font-size: 1.5rem;
transition: all 0.2s ease;
}

.modal-close:hover {
background: var(--bg-tertiary);
color: var(--text-primary);
border-color: var(--accent-primary);
}

.modal-body {
padding: 1.5rem;
}

.modal-section {
margin-bottom: 1.5rem;
}

.modal-section:last-child {
margin-bottom: 0;
}

.section-label {
font-size: 0.75rem;
font-weight: 600;
color: var(--text-muted);
text-transform: uppercase;
letter-spacing: 0.05em;
margin-bottom: 0.5rem;
}

.code-block {
font-family: 'JetBrains Mono', monospace;
font-size: 0.875rem;
background: var(--bg-primary);
border: 1px solid var(--border-color);
border-radius: var(--radius-md);
padding: 1rem;
color: var(--text-secondary);
overflow-x: auto;
max-height: 200px;
overflow-y: auto;
white-space: pre-wrap;
word-break: break-word;
line-height: 1.6;
}

.code-block::-webkit-scrollbar {
width: 6px;
height: 6px;
}

.code-block::-webkit-scrollbar-track {
background: var(--bg-secondary);
border-radius: 3px;
}

.code-block::-webkit-scrollbar-thumb {
background: var(--border-color);
border-radius: 3px;
}

.import-section {
background: linear-gradient(135deg, rgba(70, 200, 255, 0.08), rgba(124, 212, 253, 0.08));
border: 1px solid rgba(70, 200, 255, 0.2);
border-radius: var(--radius-lg);
padding: 1.25rem;
margin-top: 1.5rem;
}

.import-title {
font-size: 1rem;
font-weight: 600;
color: var(--accent-primary);
margin-bottom: 0.75rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.import-steps {
font-size: 0.9375rem;
color: var(--text-secondary);
line-height: 1.7;
padding-left: 1.25rem;
margin-bottom: 1rem;
}

.import-steps li {
margin-bottom: 0.375rem;
}

.import-box {
background: var(--bg-primary);
border: 1px solid var(--border-color);
border-radius: var(--radius-md);
padding: 1rem;
}

.import-box-label {
font-size: 0.75rem;
color: var(--text-muted);
margin-bottom: 0.5rem;
}

.import-box-row {
display: flex;
gap: 0.75rem;
}

.import-id {
font-family: 'JetBrains Mono', monospace;
font-size: 0.8125rem;
background: var(--bg-secondary);
border: 1px solid var(--border-color);
border-radius: var(--radius-md);
padding: 0.625rem 0.875rem;
color: var(--text-primary);
flex: 1;
overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap;
}

.copy-btn {
padding: 0.625rem 1rem;
background: var(--accent-primary);
border: none;
border-radius: var(--radius-md);
color: #000;
font-size: 0.9375rem;
font-weight: 600;
cursor: pointer;
display: flex;
align-items: center;
gap: 0.375rem;
transition: all 0.2s ease;
}

.copy-btn:hover {
background: var(--accent-secondary);
transform: translateY(-1px);
}

.copy-btn.copied {
background: var(--success);
}

.modal-footer {
padding: 1.25rem 1.5rem;
border-top: 1px solid var(--border-color);
display: flex;
justify-content: flex-end;
gap: 0.75rem;
}

.btn {
padding: 0.75rem 1.25rem;
border-radius: var(--radius-md);
font-size: 0.9375rem;
font-weight: 600;
cursor: pointer;
transition: all 0.2s ease;
border: none;
display: flex;
align-items: center;
gap: 0.5rem;
}

.btn-primary {
background: var(--accent-primary);
color: #000;
}

.btn-primary:hover {
background: var(--accent-secondary);
transform: translateY(-1px);
}

.btn-secondary {
background: var(--bg-primary);
border: 1px solid var(--border-color);
color: var(--text-primary);
}

.btn-secondary:hover {
background: var(--bg-tertiary);
border-color: var(--accent-primary);
}

/* Toast */
.toast {
position: fixed;
bottom: 2rem;
left: 50%;
transform: translateX(-50%) translateY(100px);
background: var(--success);
color: white;
padding: 1rem 1.5rem;
border-radius: var(--radius-lg);
font-size: 1rem;
font-weight: 500;
display: flex;
align-items: center;
gap: 0.5rem;
opacity: 0;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
z-index: 2000;
box-shadow: var(--shadow-lg);
}

.toast.show {
transform: translateX(-50%) translateY(0);
opacity: 1;
}

.toast.error {
background: var(--error);
}

/* Responsive */
@media (max-width: 768px) {
.navbar {
padding: 0 1rem;
height: 60px;
}

.hero-title {
font-size: 1.875rem;
}

.items-grid {
grid-template-columns: 1fr;
}

.section-header {
flex-direction: column;
align-items: flex-start;
gap: 0.75rem;
}

.nav-center {
order: 3;
max-width: 100%;
width: 100%;
}

.nav-links {
display: none;
}

.modal-overlay {
padding: 0;
}

.modal {
max-height: 100vh;
border-radius: var(--radius-xl) var(--radius-xl) 0 0;
position: fixed;
bottom: 0;
left: 0;
right: 0;
transform: translateY(100%);
}

.modal-overlay.active .modal {
transform: translateY(0);
}
}

@media (max-width: 480px) {
.logo span {
display: none;
}

.category-filters {
gap: 0.5rem;
}

.filter-btn {
padding: 0.5rem 0.875rem;
font-size: 0.875rem;
}
}
</style>
</head>
<body>
<nav class="navbar">
<div class="navbar-content">
<a href="/" class="logo">
<div class="logo-icon">‚ö°</div>
<span>CodingSoft Community Hub</span>
</a>
<div class="nav-center">
<div class="search-box">
<svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
</svg>
<input type="text" class="search-input" id="searchInput" placeholder="Buscar prompts, comandos, agentes...">
</div>
</div>
<div class="nav-links">
<a href="/" class="nav-link active">Explorar</a>
<a href="/admin" class="nav-link">Administrar</a>
<button class="theme-toggle" id="themeToggle" title="Cambiar tema">üåô</button>
</div>
</div>
</nav>

<main class="main">
<div class="hero">
<h1 class="hero-title">Community Hub</h1>
<p class="hero-subtitle">Descubre y comparte prompts, comandos slash y agentes personalizados con la comunidad</p>
</div>

<div class="category-filters" id="categoryFilters">
<button class="filter-btn active" data-filter="all">
<span>üì¶</span>
<span>Todos</span>
</button>
<button class="filter-btn" data-filter="systemPrompts">
<span>üìù</span>
<span>Prompts</span>
</button>
<button class="filter-btn" data-filter="slashCommands">
<span>‚ö°</span>
<span>Comandos</span>
</button>
<button class="filter-btn" data-filter="agentSkills">
<span>üéØ</span>
<span>Skills</span>
</button>
<button class="filter-btn" data-filter="agentFlows">
<span>üîÑ</span>
<span>Flows</span>
</button>
</div>

<div id="contentContainer">
<div class="skeleton-container" id="skeletonLoading">
<div class="skeleton-card">
<div class="skeleton skeleton-circle" style="margin-bottom: 1rem;"></div>
<div class="skeleton skeleton-line"></div>
<div class="skeleton skeleton-line short"></div>
</div>
<div class="skeleton-card">
<div class="skeleton skeleton-circle" style="margin-bottom: 1rem;"></div>
<div class="skeleton skeleton-line"></div>
<div class="skeleton skeleton-line short"></div>
</div>
<div class="skeleton-card">
<div class="skeleton skeleton-circle" style="margin-bottom: 1rem;"></div>
<div class="skeleton skeleton-line"></div>
<div class="skeleton skeleton-line short"></div>
</div>
</div>
</div>
</main>

<div class="modal-overlay" id="modalOverlay">
<div class="modal">
<div class="modal-header">
<div class="modal-title-group">
<h3 class="modal-title" id="modalTitle">T√≠tulo del Item</h3>
<p class="modal-subtitle" id="modalDescription">Descripci√≥n</p>
</div>
<button class="modal-close" onclick="closeModal()">√ó</button>
</div>
<div class="modal-body">
<div class="modal-section" id="commandSection" style="display: none;">
<div class="section-label">Comando</div>
<div class="code-block" id="modalCommand">/comando</div>
</div>
<div class="modal-section">
<div class="section-label" id="promptLabel">Prompt</div>
<div class="code-block" id="modalPrompt">Contenido del prompt</div>
</div>
<div class="import-section">
<div class="import-title">
<span>üì•</span>
<span>C√≥mo importar a CodingSoft</span>
</div>
<ol class="import-steps">
<li>Haz clic en "Copiar ID" a continuaci√≥n</li>
<li>Ve a <strong>Ajustes ‚Üí Community Hub ‚Üí Importar Item</strong></li>
<li>Pega el ID de importaci√≥n y contin√∫a</li>
</ol>
<div class="import-box">
<div class="import-box-label">ID de Importaci√≥n</div>
<div class="import-box-row">
<span class="import-id" id="importIdCode">codingsoft-hub-id:...</span>
<button class="copy-btn" id="copyBtn" onclick="copyImportId()">
<span>üìã</span>
<span>Copiar</span>
</button>
</div>
</div>
</div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
<button class="btn btn-primary" onclick="copyImportId()">
<span>üìã</span>
<span>Copiar ID</span>
</button>
</div>
</div>
</div>

<div class="toast" id="toast">‚úÖ Copiado al portapapeles</div>

<script>
const API_BASE = '/v1';
let allItems = { systemPrompts: [], slashCommands: [], agentSkills: [], agentFlows: [] };
let currentFilter = 'all';

const typeConfig = {
systemPrompts: { label: 'System Prompts', icon: 'üìù', color: 'prompts', shortLabel: 'Prompts' },
slashCommands: { label: 'Slash Commands', icon: '‚ö°', color: 'commands', shortLabel: 'Comandos' },
agentSkills: { label: 'Agent Skills', icon: 'üéØ', color: 'skills', shortLabel: 'Skills' },
agentFlows: { label: 'Agent Flows', icon: 'üîÑ', color: 'flows', shortLabel: 'Flows' }
};

const typeMap = {
'systemPrompts': 'system-prompt',
'slashCommands': 'slash-command',
'agentSkills': 'agent-skill',
'agentFlows': 'agent-flow'
};

function initTheme() {
const savedTheme = localStorage.getItem('theme') || 'dark';
document.documentElement.setAttribute('data-theme', savedTheme);
updateThemeIcon(savedTheme);
}

function toggleTheme() {
const currentTheme = document.documentElement.getAttribute('data-theme');
const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
document.documentElement.setAttribute('data-theme', newTheme);
localStorage.setItem('theme', newTheme);
updateThemeIcon(newTheme);
}

function updateThemeIcon(theme) {
const btn = document.getElementById('themeToggle');
btn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
btn.title = theme === 'dark' ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro';
}

function renderSkeleton() {
const container = document.getElementById('contentContainer');
container.innerHTML = `
<div class="skeleton-container">
${Array(6).fill(0).map(() => `
<div class="skeleton-card">
<div style="display: flex; align-items: center; gap: 0.875rem; margin-bottom: 1rem;">
<div class="skeleton skeleton-circle"></div>
<div style="flex: 1;">
<div class="skeleton skeleton-line" style="width: 70%; margin-bottom: 0.5rem;"></div>
<div class="skeleton skeleton-line" style="width: 40%;"></div>
</div>
</div>
<div class="skeleton skeleton-line medium"></div>
<div class="skeleton skeleton-line short"></div>
</div>
`).join('')}
</div>
`;
}

async function fetchItems() {
renderSkeleton();
try {
const response = await fetch(`${API_BASE}/explore`);
const data = await response.json();
allItems = {
'systemPrompts': data.systemprompts?.items || [],
'slashCommands': data.slashcommands?.items || [],
'agentSkills': data.agentskills?.items || [],
'agentFlows': data.agentflows?.items || []
};
renderCategories();
} catch (error) {
console.error('Error fetching items:', error);
document.getElementById('contentContainer').innerHTML = `
<div class="empty-state">
<div class="empty-state-icon">‚ö†Ô∏è</div>
<div class="empty-state-title">Error al cargar</div>
<div class="empty-state-text">No se pudieron cargar los items. Aseg√∫rate de que el servidor est√© ejecut√°ndose.</div>
</div>
`;
}
}

function renderCategories() {
const container = document.getElementById('contentContainer');
const categories = Object.keys(allItems).filter(type => allItems[type]?.length > 0);

if (categories.length === 0) {
container.innerHTML = `
<div class="empty-state">
<div class="empty-state-icon">üì¶</div>
<div class="empty-state-title">No hay items</div>
<div class="empty-state-text">No se encontraron items en el Community Hub.</div>
</div>
`;
return;
}

const categoriesToShow = currentFilter === 'all' ? categories : categories.filter(c => c === currentFilter);

container.innerHTML = categoriesToShow.map(type => {
const config = typeConfig[type];
return `
<div class="category-section" style="margin-bottom: 3rem;">
<div class="section-header">
<h2 class="section-title">
<div class="section-icon ${config.color}">${config.icon}</div>
${config.label}
</h2>
<span class="item-count">${allItems[type].length} items</span>
</div>
<div class="items-grid">
${allItems[type].map(item => renderCard(type, item)).join('')}
</div>
</div>
`;
}).join('');
}

function renderCard(type, item) {
const itemType = typeMap[type] || type.toLowerCase().replace(/s$/, '');
const importId = item.importId || `codingsoft-hub-id:${itemType}:${item.id}`;
const config = typeConfig[type];

return `
<div class="item-card type-${itemType.replace('-', '')}" onclick="showItem('${type}', '${item.id}')">
<div class="card-header">
<div class="card-icon ${config.color}">${config.icon}</div>
<div class="card-title-group">
<div class="card-title">${item.name}</div>
<div class="card-meta">
<span class="visibility-badge ${item.visibility || 'public'}">${item.visibility === 'private' ? 'Privado' : 'P√∫blico'}</span>
<span>‚Ä¢</span>
<span>${item.author || 'CodingSoft'}</span>
</div>
</div>
</div>
<p class="card-description">${item.description}</p>
<div class="card-footer">
<div class="card-tags">
${(item.tags || []).slice(0, 3).map(tag => `<span class="card-tag">${tag}</span>`).join('')}
</div>
<span class="card-action">Importar ‚Üí</span>
</div>
</div>
`;
}

function showItem(type, id) {
const item = allItems[type]?.find(i => i.id === id);
if (!item) return;

const itemType = typeMap[type] || type.toLowerCase().replace(/s$/, '');
const importId = item.importId || `codingsoft-hub-id:${itemType}:${item.id}`;

const modalOverlay = document.getElementById('modalOverlay');
const copyBtn = document.getElementById('copyBtn');
copyBtn.classList.remove('copied');
copyBtn.innerHTML = '<span>üìã</span><span>Copiar</span>';

document.getElementById('modalTitle').textContent = item.name;
document.getElementById('modalDescription').textContent = item.description;
document.getElementById('commandSection').style.display = type === 'slashCommands' ? 'block' : 'none';
document.getElementById('modalCommand').textContent = item.command || '';
document.getElementById('promptLabel').textContent = type === 'systemPrompts' ? 'Prompt' : 'Configuraci√≥n';
document.getElementById('modalPrompt').textContent = item.prompt || item.config || '';
document.getElementById('importIdCode').textContent = importId;

modalOverlay.classList.add('active');
document.body.style.overflow = 'hidden';
}

function closeModal() {
const modalOverlay = document.getElementById('modalOverlay');
modalOverlay.classList.remove('active');
document.body.style.overflow = '';
}

async function copyImportId() {
const importId = document.getElementById('importIdCode').textContent;
const copyBtn = document.getElementById('copyBtn');

try {
await navigator.clipboard.writeText(importId);
copyBtn.classList.add('copied');
copyBtn.innerHTML = '<span>‚úì</span><span>¬°Copiado!</span>';
showToast('‚úÖ ID copiado al portapapeles');

setTimeout(() => {
copyBtn.classList.remove('copied');
copyBtn.innerHTML = '<span>üìã</span><span>Copiar</span>';
}, 2000);
} catch (e) {
showToast('‚ùå Error al copiar', true);
}
}

function showToast(message, isError = false) {
const toast = document.getElementById('toast');
toast.textContent = message;
toast.classList.toggle('error', isError);
toast.classList.add('show');
setTimeout(() => toast.classList.remove('show'), 3000);
}

function filterItems() {
const search = document.getElementById('searchInput').value.toLowerCase();
document.querySelectorAll('.item-card').forEach(card => {
const name = card.querySelector('.card-title')?.textContent?.toLowerCase() || '';
const desc = card.querySelector('.card-description')?.textContent?.toLowerCase() || '';
card.closest('.category-section').style.display = (name.includes(search) || desc.includes(search) || !search) ? '' : 'none';
});
}

function setupFilters() {
document.querySelectorAll('.filter-btn').forEach(btn => {
btn.addEventListener('click', () => {
document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
btn.classList.add('active');
currentFilter = btn.dataset.filter;
renderCategories();
});
});
}

// Event listeners
document.getElementById('searchInput').addEventListener('input', filterItems);
document.getElementById('modalOverlay').addEventListener('click', (e) => {
if (e.target === document.getElementById('modalOverlay')) closeModal();
});
document.addEventListener('keydown', (e) => {
if (e.key === 'Escape') closeModal();
});
document.getElementById('themeToggle').addEventListener('click', toggleTheme);

// Initialize
initTheme();
setupFilters();
fetchItems();
</script>
</body>
</html>
